<p align="center">
    <a href="https://github.com/WolfSoftware">
        <img src="https://raw.githubusercontent.com/WolfSoftware/branding/master/images/general/banners/64/black-and-white.png" alt="Wolf Software Logo" />
    </a>
    <br />
    <a href="https://github.com/CICDToolbox/json-lint/actions/workflows/pipeline.yml">
        <img src="https://img.shields.io/github/workflow/status/CICDToolbox/json-lint/pipeline/master?logo=github&logoColor=white&style=for-the-badge" alt="Github Build Status">
    </a>
    <a href="https://github.com/CICDToolbox/json-lint/releases/latest">
        <img src="https://img.shields.io/github/v/release/CICDToolbox/json-lint?color=blue&style=for-the-badge&logo=github&logoColor=white&label=Latest%20Release" alt="Release">
    </a>
    <a href="https://github.com/CICDToolbox/json-lint/releases/latest">
        <img src="https://img.shields.io/github/commits-since/CICDToolbox/json-lint/latest.svg?color=blue&style=for-the-badge&logo=github&logoColor=white" alt="Commits since release">
    </a>
    <br />
    <a href=".github/CODE_OF_CONDUCT.md">
        <img src="https://img.shields.io/badge/Code%20of%20Conduct-blue?style=for-the-badge&logo=read-the-docs&logoColor=white" />
    </a>
    <a href=".github/CONTRIBUTING.md">
        <img src="https://img.shields.io/badge/Contributing-blue?style=for-the-badge&logo=read-the-docs&logoColor=white" />
    </a>
    <a href=".github/SECURITY.md">
        <img src="https://img.shields.io/badge/Report%20Security%20Concern-blue?style=for-the-badge&logo=read-the-docs&logoColor=white" />
    </a>
    <a href="https://github.com/CICDToolbox/json-lint/issues">
        <img src="https://img.shields.io/badge/Get%20Support-blue?style=for-the-badge&logo=read-the-docs&logoColor=white" />
    </a>
</p>

## Overview

A tool to check your JSON files in CI/CD pipelines using [jq](https://stedolan.github.io/jq/).

> Also see: [validate-json](https://github.com/DevelopersToolbox/validate-json) for our bash plugin to do the same thing.

This tool has been written and tested using GitHub Actions but it should work out of the box with a lot of other CI/CD tools.

## Usage

```yml
on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    - name: Run JSON Lint
      run: wget --quiet -O - https://raw.githubusercontent.com/CICDToolbox/json-lint/master/pipeline.sh | bash
```

### Other Options

The following environment variables can be set in order to customise the script.

| Name          | Purpose | Default Value |
| ------------- | ------- | ------------- |
| EXCLUDE_FILES | A comma separated list of files to exclude from being scanned. | Unset |
| EXIT_ON_INSTALL_FAILURE | Exit the script if the install of the prerequisites fails (they might already exist). | False |
| REPORT_ONLY   | Generate the report but do not fail the build even if an error occurred. | False | 
| SHOW_ERRORS   | Show the actual errors instead of just which files had errors. | False | 

You can use any combination of the above settings.

```yml
on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    - name: Run JSON Lint
      env:
        EXIT_ON_INSTALL_FAILURE: true
        REPORT_ONLY: true
        SHOW_ERRORS: true
      run: bash <(curl -s https://raw.githubusercontent.com/CICDToolbox/json-lint/master/pipeline.sh)
```

## Example Output

This is an example of the output report generated by this tool, this is the actual output from the tool running against itself.

```
--------------------------------------------------------------------------------
                    Scanning all JSON with jq (version: 1.6)
--------------------------------------------------------------------------------
 [  OK  ] Processing successful for tests/data.json
--------------------------------------------------------------------------------
                     Total: 1, OK: 1, Failed: 0, Skipped: 0
--------------------------------------------------------------------------------
```

## File Identification

Target files are identified using the following code:

```shell
file -b "${filename}" | grep -qE '^JSON'

AND

[[ ${filename} =~ \.json$ ]]
```

<p align="right">
    <a href="https://github.com/TGWolf">
        <img src="https://img.shields.io/badge/Created%20by%20Wolf-black?style=for-the-badge" />
    </a>
    <br />
    <a href="https://ko-fi.com/wolfsoftware">
        <img src="https://img.shields.io/badge/Ko%20Fi-black?style=for-the-badge&logo=ko-fi&logoColor=white" />
    </a>
</p>
